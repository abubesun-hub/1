<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุตูุงุญ ุงูุฏููู ุงููุญุงุณุจู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">ุฅุตูุงุญ ุงูุฏููู ุงููุญุงุณุจู ูู ุงููุธุงู</h1>
        
        <div class="row mt-4">
            <div class="col-12 text-center">
                <button class="btn btn-primary btn-lg me-2" onclick="createGuideInSystem()">ุฅูุดุงุก ุงูุฏููู ูู ุงููุธุงู</button>
                <button class="btn btn-success btn-lg me-2" onclick="testGuideInSystem()">ุงุฎุชุจุงุฑ ุงูุฏููู ูู ุงููุธุงู</button>
                <button class="btn btn-info btn-lg me-2" onclick="simpleGuideTest()">ุงุฎุชุจุงุฑ ูุจุณุท</button>
                <button class="btn btn-secondary btn-lg me-2" onclick="goToExpenses()">ุงูุฐูุงุจ ูููุตุฑููุงุช</button>
                <button class="btn btn-warning btn-lg" onclick="openMainSystem()">ูุชุญ ุงููุธุงู ุงูุฑุฆูุณู</button>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ุงููุชุงุฆุฌ ูุงูุชุดุฎูุต</h5>
                    </div>
                    <div class="card-body">
                        <div id="results" style="height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; font-family: monospace; font-size: 12px;">
                            <p>ุฌุงุฑู ุงูุชุญููู...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Embedded Expenses Section for Testing -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ุงุฎุชุจุงุฑ ูุจุงุดุฑ - ูุณู ุงููุตุฑููุงุช</h5>
                    </div>
                    <div class="card-body">
                        <div id="expensesSection">
                            <div id="expensesContent">
                                <!-- Expenses content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load all required scripts -->
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const time = new Date().toLocaleTimeString('ar-IQ');
            results.innerHTML += `<div>[${time}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function createGuideInSystem() {
            log('๐ง ุฅูุดุงุก ุงูุฏููู ุงููุญุงุณุจู ูู ุงููุธุงู...');
            
            try {
                // Create default guide data
                const defaultGuide = [
                    // ููุงุฏ ุงูุจูุงุก
                    { id: 'guide001', code: '5101', name: 'ุงูุฃุณููุช', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฃุณููุช ุจูุฑุชูุงูุฏู ุนุงุฏู ูุฎุงุต', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide002', code: '5102', name: 'ุงูุญุฏูุฏ ูุงูุตูุจ', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุญุฏูุฏ ุงูุชุณููุญ ููุถุจุงู ุงูุตูุจ', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide003', code: '5103', name: 'ุงูุฑูู ูุงูุญุตู', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฑูู ุงูุจูุงุก ูุงูุญุตู ุงููุฎุชูู', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide004', code: '5104', name: 'ุงูุทูุจ ูุงูุจููู', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุทูุจ ุฃุญูุฑ ูุจููู ุฎุฑุณุงูู', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide005', code: '5105', name: 'ุงูุจูุงุท ูุงูุณูุฑุงููู', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุจูุงุท ุฃุฑุถูุงุช ูุณูุฑุงููู ุฌุฏุฑุงู', notes: '', createdAt: new Date().toISOString() },

                    // ุงูุนูุงูุฉ
                    { id: 'guide006', code: '5201', name: 'ุฃุฌูุฑ ุงูุนูุงู ุงูููุฑุฉ', category: 'ุงูุนูุงูุฉ', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฃุฌูุฑ ุงูุจูุงุฆูู ูุงูุญุฑูููู ุงูููุฑุฉ', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide007', code: '5202', name: 'ุฃุฌูุฑ ุงูุนูุงู ุงูุนุงุฏููู', category: 'ุงูุนูุงูุฉ', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฃุฌูุฑ ุงูุนูุงู ุบูุฑ ุงูููุฑุฉ', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide008', code: '5203', name: 'ุฃุฌูุฑ ุงูููุงูููู ุงููุฑุนููู', category: 'ุงูุนูุงูุฉ', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ูุฏููุนุงุช ููููุงูููู ุงููุฑุนููู', notes: '', createdAt: new Date().toISOString() },

                    // ุงููุนุฏุงุช ูุงูุขูุงุช
                    { id: 'guide009', code: '5301', name: 'ุฅูุฌุงุฑ ุงููุนุฏุงุช ุงูุซูููุฉ', category: 'ุงููุนุฏุงุช ูุงูุขูุงุช', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฅูุฌุงุฑ ุงูุญูุงุฑุงุช ูุงูุฑุงูุนุงุช', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide010', code: '5302', name: 'ุตูุงูุฉ ุงููุนุฏุงุช', category: 'ุงููุนุฏุงุช ูุงูุขูุงุช', type: 'ูุตุฑูู ุชุดุบููู', description: 'ุตูุงูุฉ ูุฅุตูุงุญ ุงููุนุฏุงุช', notes: '', createdAt: new Date().toISOString() },

                    // ุงูููู ูุงูููุงุตูุงุช
                    { id: 'guide011', code: '5401', name: 'ููู ุงูููุงุฏ', category: 'ุงูููู ูุงูููุงุตูุงุช', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ููู ููุงุฏ ุงูุจูุงุก ูููููุน', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide012', code: '5402', name: 'ูุตุงุฑูู ุงูุดุงุญูุงุช', category: 'ุงูููู ูุงูููุงุตูุงุช', type: 'ูุตุฑูู ุชุดุบููู', description: 'ูููุฏ ูุตูุงูุฉ ุงูุดุงุญูุงุช', notes: '', createdAt: new Date().toISOString() },

                    // ุงููููุฏ ูุงูุทุงูุฉ
                    { id: 'guide013', code: '5501', name: 'ูููุฏ ุงููุนุฏุงุช', category: 'ุงููููุฏ ูุงูุทุงูุฉ', type: 'ูุตุฑูู ุชุดุบููู', description: 'ุฏูุฒู ูุจูุฒูู ูููุนุฏุงุช', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide014', code: '5502', name: 'ุงูููุฑุจุงุก', category: 'ุงููููุฏ ูุงูุทุงูุฉ', type: 'ูุตุฑูู ุชุดุบููู', description: 'ููุงุชูุฑ ุงูููุฑุจุงุก ูููููุน', notes: '', createdAt: new Date().toISOString() },

                    // ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ
                    { id: 'guide015', code: '5601', name: 'ุฑูุงุชุจ ุงูููุธููู', category: 'ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ุฑูุงุชุจ ุงูููุธููู ุงูุฅุฏุงุฑููู', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide016', code: '5602', name: 'ููุงูุขุช ููุฒุงูุง', category: 'ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ููุงูุขุช ููุฒุงูุง ุงูููุธููู', notes: '', createdAt: new Date().toISOString() },

                    // ุงูููุชุจ ูุงูุฅุฏุงุฑุฉ
                    { id: 'guide017', code: '5701', name: 'ุงููุฑุทุงุณูุฉ ูุงูููุชุจูุงุช', category: 'ุงูููุชุจ ูุงูุฅุฏุงุฑุฉ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ุฃูุฑุงู ูุฃููุงู ููุณุชูุฒูุงุช ููุชุจูุฉ', notes: '', createdAt: new Date().toISOString() },
                    { id: 'guide018', code: '5702', name: 'ุงูุงุชุตุงูุงุช', category: 'ุงูููุชุจ ูุงูุฅุฏุงุฑุฉ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ูุงุชู ูุฅูุชุฑูุช ููุงูุณ', notes: '', createdAt: new Date().toISOString() },

                    // ุงูุชุฃููู
                    { id: 'guide019', code: '5801', name: 'ุชุฃููู ุงููุดุฑูุน', category: 'ุงูุชุฃููู', type: 'ูุตุฑูู ุบูุฑ ูุจุงุดุฑ', description: 'ุชุฃููู ุถุฏ ุงููุฎุงุทุฑ ูุงูุญูุงุฏุซ', notes: '', createdAt: new Date().toISOString() },

                    // ุฃุฎุฑู
                    { id: 'guide020', code: '5901', name: 'ูุตุฑููุงุช ูุชููุนุฉ', category: 'ุฃุฎุฑู', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ูุตุฑููุงุช ุฃุฎุฑู ุบูุฑ ูุตููุฉ', notes: '', createdAt: new Date().toISOString() }
                ];
                
                // Save to storage
                const saved = StorageManager.saveData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE, defaultGuide);
                
                if (saved) {
                    log('โ ุชู ุฅูุดุงุก ุงูุฏููู ุงููุญุงุณุจู ุจูุฌุงุญ!');
                    log(`๐ ุชู ุฅูุดุงุก ${defaultGuide.length} ุนูุตุฑ ูู ุงูุฏููู`);
                    
                    // Verify save
                    const verified = StorageManager.getData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE);
                    log(`โ ุชู ุงูุชุญูู: ${verified ? verified.length : 0} ุนูุตุฑ ูุญููุธ`);
                } else {
                    log('โ ูุดู ูู ุญูุธ ุงูุฏููู ุงููุญุงุณุจู');
                }
                
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฏููู: ' + error.message);
            }
        }
        
        function testGuideInSystem() {
            log('๐งช ุงุฎุชุจุงุฑ ุงูุฏููู ุงููุญุงุณุจู ูู ุงููุธุงู...');

            try {
                // Force create ExpensesManager if not available
                if (typeof expensesManager === 'undefined' || !expensesManager) {
                    log('๐ ุฅูุดุงุก ExpensesManager ุฌุฏูุฏ...');

                    if (typeof ExpensesManager !== 'undefined') {
                        window.expensesManager = new ExpensesManager();
                        log('โ ุชู ุฅูุดุงุก ExpensesManager ุฌุฏูุฏ');
                    } else {
                        log('โ ูุฆุฉ ExpensesManager ุบูุฑ ูุชููุฑุฉ');
                        return;
                    }
                }

                log('โ ExpensesManager ูุชููุฑ');

                // Load accounting guide view directly in the embedded section
                const expensesContent = document.getElementById('expensesContent');
                if (expensesContent) {
                    log('๐ ุชุญููู ุนุฑุถ ุงูุฏููู ุงููุญุงุณุจู...');

                    // Load the accounting guide view
                    expensesManager.loadAccountingGuideView();
                    log('โ ุชู ุชุญููู ุนุฑุถ ุงูุฏููู ุงููุญุงุณุจู ูู ุงููุณู ุงููุฏูุฌ');
                } else {
                    log('โ ุนูุตุฑ expensesContent ุบูุฑ ููุฌูุฏ');
                }

            } catch (error) {
                log('โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุงูุฏููู: ' + error.message);
                console.error('Error details:', error);
            }
        }
        
        function simpleGuideTest() {
            log('๐งช ุงุฎุชุจุงุฑ ูุจุณุท ููุฏููู ุงููุญุงุณุจู...');

            try {
                // Check if guide exists
                const guide = StorageManager.getData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE);
                if (!guide || guide.length === 0) {
                    log('โ ูุง ููุฌุฏ ุฏููู ูุญุงุณุจู - ูู ุจุฅูุดุงุฆู ุฃููุงู');
                    return;
                }

                log(`โ ููุฌุฏ ุฏููู ูุญุงุณุจู ุจู ${guide.length} ุนูุตุฑ`);

                // Create simple HTML display
                const expensesContent = document.getElementById('expensesContent');
                if (expensesContent) {
                    let html = `
                        <div class="neumorphic-card">
                            <div class="card-header">
                                <h4><i class="bi bi-book me-2"></i>ุงูุฏููู ุงููุญุงุณุจู (${guide.length} ุนูุตุฑ)</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                    `;

                    // Group by category
                    const grouped = {};
                    guide.forEach(item => {
                        if (!grouped[item.category]) {
                            grouped[item.category] = [];
                        }
                        grouped[item.category].push(item);
                    });

                    Object.keys(grouped).forEach(category => {
                        html += `
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">${category} (${grouped[category].length})</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>ุงูุฑูุฒ</th>
                                                        <th>ุงูุงุณู</th>
                                                        <th>ุงูููุน</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                        `;

                        grouped[category].forEach(item => {
                            html += `
                                <tr>
                                    <td><strong>${item.code}</strong></td>
                                    <td>${item.name}</td>
                                    <td><span class="badge bg-secondary">${item.type}</span></td>
                                </tr>
                            `;
                        });

                        html += `
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    html += `
                                </div>
                            </div>
                        </div>
                    `;

                    expensesContent.innerHTML = html;
                    log('โ ุชู ุนุฑุถ ุงูุฏููู ุงููุญุงุณุจู ุจูุฌุงุญ!');
                } else {
                    log('โ ุนูุตุฑ expensesContent ุบูุฑ ููุฌูุฏ');
                }

            } catch (error) {
                log('โ ุฎุทุฃ ูู ุงูุงุฎุชุจุงุฑ ุงููุจุณุท: ' + error.message);
            }
        }

        function goToExpenses() {
            log('๐ ุงูุฐูุงุจ ุฅูู ูุณู ุงููุตุฑููุงุช...');

            try {
                if (typeof expensesManager !== 'undefined' && expensesManager) {
                    // Load expenses section in the embedded area
                    expensesManager.loadExpensesSection();
                    log('โ ุชู ุชุญููู ูุณู ุงููุตุฑููุงุช');
                } else {
                    log('โ ExpensesManager ุบูุฑ ูุชููุฑ');
                }
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุชุญููู ุงููุตุฑููุงุช: ' + error.message);
            }
        }
        
        function openMainSystem() {
            log('๐ ูุชุญ ุงููุธุงู ุงูุฑุฆูุณู...');
            window.open('index.html', '_blank');
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('โ ุชู ุชุญููู ุตูุญุฉ ุฅุตูุงุญ ุงูุฏููู ุงููุญุงุณุจู');
            
            // Check components
            setTimeout(() => {
                log('๐ ูุญุต ุงูููููุงุช...');
                
                if (typeof StorageManager !== 'undefined') {
                    log('โ StorageManager ูุชููุฑ');
                } else {
                    log('โ StorageManager ุบูุฑ ูุชููุฑ');
                }
                
                if (typeof ExpensesManager !== 'undefined') {
                    log('โ ูุฆุฉ ExpensesManager ูุชููุฑุฉ');
                } else {
                    log('โ ูุฆุฉ ExpensesManager ุบูุฑ ูุชููุฑุฉ');
                }
                
                if (typeof expensesManager !== 'undefined' && expensesManager) {
                    log('โ ูุซูู expensesManager ูุชููุฑ');
                } else {
                    log('โ ูุซูู expensesManager ุบูุฑ ูุชููุฑ');
                }
                
                // Check existing guide
                const existingGuide = StorageManager.getData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE);
                if (existingGuide && existingGuide.length > 0) {
                    log(`โ ููุฌุฏ ุฏููู ูุญุงุณุจู ุจู ${existingGuide.length} ุนูุตุฑ`);
                } else {
                    log('โน๏ธ ูุง ููุฌุฏ ุฏููู ูุญุงุณุจู - ูููู ุฅูุดุงุคู');
                }
                
                log('๐ฏ ุฌุงูุฒ ููุงุฎุชุจุงุฑ!');
            }, 1000);
        });
    </script>
</body>
</html>
