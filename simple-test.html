<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุจุณูุท - ุงูุฏููู ุงููุญุงุณุจู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">ุงุฎุชุจุงุฑ ุงูุฏููู ุงููุญุงุณุจู ุงููุจุณุท</h1>
        
        <div class="row mt-4">
            <div class="col-12 text-center">
                <button class="btn btn-primary btn-lg me-2" onclick="createGuide()">ุฅูุดุงุก ุงูุฏููู ุงููุญุงุณุจู</button>
                <button class="btn btn-success btn-lg me-2" onclick="testGuide()">ุงุฎุชุจุงุฑ ุงูุฏููู</button>
                <button class="btn btn-info btn-lg me-2" onclick="showGuide()">ุนุฑุถ ุงูุฏููู</button>
                <button class="btn btn-danger btn-lg me-2" onclick="fixLogin()">ุฅุตูุงุญ ุชุณุฌูู ุงูุฏุฎูู</button>
                <button class="btn btn-warning btn-lg" onclick="goToSystem()">ุงูุฐูุงุจ ูููุธุงู</button>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ุงููุชุงุฆุฌ</h5>
                    </div>
                    <div class="card-body">
                        <div id="results" style="height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; font-family: monospace;">
                            <p>ุงุถุบุท ุนูู ุงูุฃุฒุฑุงุฑ ุฃุนูุงู ูุจุฏุก ุงูุงุฎุชุจุงุฑ...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Guide Display Area -->
        <div id="guideDisplay" class="row mt-4" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ุงูุฏููู ุงููุญุงุณุจู</h5>
                    </div>
                    <div class="card-body" id="guideContent">
                        <!-- Guide content will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/storage.js"></script>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const time = new Date().toLocaleTimeString('ar-IQ');
            results.innerHTML += `<div>[${time}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function createGuide() {
            log('๐ ุจุฏุก ุฅูุดุงุก ุงูุฏููู ุงููุญุงุณุจู...');
            
            const defaultGuide = [
                // ููุงุฏ ุงูุจูุงุก
                { id: 'guide001', code: '5101', name: 'ุงูุฃุณููุช', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฃุณููุช ุจูุฑุชูุงูุฏู ุนุงุฏู ูุฎุงุต', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide002', code: '5102', name: 'ุงูุญุฏูุฏ ูุงูุตูุจ', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุญุฏูุฏ ุงูุชุณููุญ ููุถุจุงู ุงูุตูุจ', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide003', code: '5103', name: 'ุงูุฑูู ูุงูุญุตู', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฑูู ุงูุจูุงุก ูุงูุญุตู ุงููุฎุชูู', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide004', code: '5104', name: 'ุงูุทูุจ ูุงูุจููู', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุทูุจ ุฃุญูุฑ ูุจููู ุฎุฑุณุงูู', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide005', code: '5105', name: 'ุงูุจูุงุท ูุงูุณูุฑุงููู', category: 'ููุงุฏ ุงูุจูุงุก', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุจูุงุท ุฃุฑุถูุงุช ูุณูุฑุงููู ุฌุฏุฑุงู', notes: '', createdAt: new Date().toISOString() },

                // ุงูุนูุงูุฉ
                { id: 'guide006', code: '5201', name: 'ุฃุฌูุฑ ุงูุนูุงู ุงูููุฑุฉ', category: 'ุงูุนูุงูุฉ', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฃุฌูุฑ ุงูุจูุงุฆูู ูุงูุญุฑูููู ุงูููุฑุฉ', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide007', code: '5202', name: 'ุฃุฌูุฑ ุงูุนูุงู ุงูุนุงุฏููู', category: 'ุงูุนูุงูุฉ', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฃุฌูุฑ ุงูุนูุงู ุบูุฑ ุงูููุฑุฉ', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide008', code: '5203', name: 'ุฃุฌูุฑ ุงูููุงูููู ุงููุฑุนููู', category: 'ุงูุนูุงูุฉ', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ูุฏููุนุงุช ููููุงูููู ุงููุฑุนููู', notes: '', createdAt: new Date().toISOString() },

                // ุงููุนุฏุงุช ูุงูุขูุงุช
                { id: 'guide009', code: '5301', name: 'ุฅูุฌุงุฑ ุงููุนุฏุงุช ุงูุซูููุฉ', category: 'ุงููุนุฏุงุช ูุงูุขูุงุช', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ุฅูุฌุงุฑ ุงูุญูุงุฑุงุช ูุงูุฑุงูุนุงุช', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide010', code: '5302', name: 'ุตูุงูุฉ ุงููุนุฏุงุช', category: 'ุงููุนุฏุงุช ูุงูุขูุงุช', type: 'ูุตุฑูู ุชุดุบููู', description: 'ุตูุงูุฉ ูุฅุตูุงุญ ุงููุนุฏุงุช', notes: '', createdAt: new Date().toISOString() },

                // ุงูููู ูุงูููุงุตูุงุช
                { id: 'guide011', code: '5401', name: 'ููู ุงูููุงุฏ', category: 'ุงูููู ูุงูููุงุตูุงุช', type: 'ูุตุฑูู ูุจุงุดุฑ', description: 'ููู ููุงุฏ ุงูุจูุงุก ูููููุน', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide012', code: '5402', name: 'ูุตุงุฑูู ุงูุดุงุญูุงุช', category: 'ุงูููู ูุงูููุงุตูุงุช', type: 'ูุตุฑูู ุชุดุบููู', description: 'ูููุฏ ูุตูุงูุฉ ุงูุดุงุญูุงุช', notes: '', createdAt: new Date().toISOString() },

                // ุงููููุฏ ูุงูุทุงูุฉ
                { id: 'guide013', code: '5501', name: 'ูููุฏ ุงููุนุฏุงุช', category: 'ุงููููุฏ ูุงูุทุงูุฉ', type: 'ูุตุฑูู ุชุดุบููู', description: 'ุฏูุฒู ูุจูุฒูู ูููุนุฏุงุช', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide014', code: '5502', name: 'ุงูููุฑุจุงุก', category: 'ุงููููุฏ ูุงูุทุงูุฉ', type: 'ูุตุฑูู ุชุดุบููู', description: 'ููุงุชูุฑ ุงูููุฑุจุงุก ูููููุน', notes: '', createdAt: new Date().toISOString() },

                // ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ
                { id: 'guide015', code: '5601', name: 'ุฑูุงุชุจ ุงูููุธููู', category: 'ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ุฑูุงุชุจ ุงูููุธููู ุงูุฅุฏุงุฑููู', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide016', code: '5602', name: 'ููุงูุขุช ููุฒุงูุง', category: 'ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ููุงูุขุช ููุฒุงูุง ุงูููุธููู', notes: '', createdAt: new Date().toISOString() },

                // ุงูููุชุจ ูุงูุฅุฏุงุฑุฉ
                { id: 'guide017', code: '5701', name: 'ุงููุฑุทุงุณูุฉ ูุงูููุชุจูุงุช', category: 'ุงูููุชุจ ูุงูุฅุฏุงุฑุฉ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ุฃูุฑุงู ูุฃููุงู ููุณุชูุฒูุงุช ููุชุจูุฉ', notes: '', createdAt: new Date().toISOString() },
                { id: 'guide018', code: '5702', name: 'ุงูุงุชุตุงูุงุช', category: 'ุงูููุชุจ ูุงูุฅุฏุงุฑุฉ', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ูุงุชู ูุฅูุชุฑูุช ููุงูุณ', notes: '', createdAt: new Date().toISOString() },

                // ุงูุชุฃููู
                { id: 'guide019', code: '5801', name: 'ุชุฃููู ุงููุดุฑูุน', category: 'ุงูุชุฃููู', type: 'ูุตุฑูู ุบูุฑ ูุจุงุดุฑ', description: 'ุชุฃููู ุถุฏ ุงููุฎุงุทุฑ ูุงูุญูุงุฏุซ', notes: '', createdAt: new Date().toISOString() },

                // ุฃุฎุฑู
                { id: 'guide020', code: '5901', name: 'ูุตุฑููุงุช ูุชููุนุฉ', category: 'ุฃุฎุฑู', type: 'ูุตุฑูู ุฅุฏุงุฑู', description: 'ูุตุฑููุงุช ุฃุฎุฑู ุบูุฑ ูุตููุฉ', notes: '', createdAt: new Date().toISOString() }
            ];
            
            try {
                const saved = StorageManager.saveData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE, defaultGuide);
                if (saved) {
                    log('โ ุชู ุฅูุดุงุก ุงูุฏููู ุงููุญุงุณุจู ุจูุฌุงุญ!');
                    log(`๐ ุชู ุฅูุดุงุก ${defaultGuide.length} ุนูุตุฑ ูู ุงูุฏููู`);
                } else {
                    log('โ ูุดู ูู ุญูุธ ุงูุฏููู ุงููุญุงุณุจู');
                }
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฏููู: ' + error.message);
            }
        }
        
        function testGuide() {
            log('๐ ุงุฎุชุจุงุฑ ุงูุฏููู ุงููุญุงุณุจู...');
            
            try {
                const guide = StorageManager.getData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE);
                
                if (guide && guide.length > 0) {
                    log(`โ ุงูุฏููู ุงููุญุงุณุจู ููุฌูุฏ ููุญุชูู ุนูู ${guide.length} ุนูุตุฑ`);
                    log(`๐ ุฃูู ุนูุตุฑ: ${guide[0].code} - ${guide[0].name}`);
                    log(`๐ ุขุฎุฑ ุนูุตุฑ: ${guide[guide.length-1].code} - ${guide[guide.length-1].name}`);
                    
                    // Count categories
                    const categories = [...new Set(guide.map(item => item.category))];
                    log(`๐ ุนุฏุฏ ุงููุฆุงุช: ${categories.length}`);
                    categories.forEach(cat => {
                        const count = guide.filter(item => item.category === cat).length;
                        log(`   - ${cat}: ${count} ุนูุตุฑ`);
                    });
                    
                } else {
                    log('โ ุงูุฏููู ุงููุญุงุณุจู ุบูุฑ ููุฌูุฏ ุฃู ูุงุฑุบ');
                }
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุงูุฏููู: ' + error.message);
            }
        }
        
        function showGuide() {
            log('๐ ุนุฑุถ ุงูุฏููู ุงููุญุงุณุจู...');
            
            try {
                const guide = StorageManager.getData(StorageManager.STORAGE_KEYS.ACCOUNTING_GUIDE);
                
                if (!guide || guide.length === 0) {
                    log('โ ูุง ููุฌุฏ ุฏููู ูุญุงุณุจู ูุนุฑุถู');
                    return;
                }
                
                // Group by category
                const grouped = {};
                guide.forEach(item => {
                    if (!grouped[item.category]) {
                        grouped[item.category] = [];
                    }
                    grouped[item.category].push(item);
                });
                
                let html = '<div class="row">';
                
                Object.keys(grouped).forEach(category => {
                    html += `
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">${category} (${grouped[category].length})</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>ุงูุฑูุฒ</th>
                                                    <th>ุงูุงุณู</th>
                                                    <th>ุงูููุน</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                    `;
                    
                    grouped[category].forEach(item => {
                        html += `
                            <tr>
                                <td><strong>${item.code}</strong></td>
                                <td>${item.name}</td>
                                <td><span class="badge bg-secondary">${item.type}</span></td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                
                document.getElementById('guideContent').innerHTML = html;
                document.getElementById('guideDisplay').style.display = 'block';
                
                log('โ ุชู ุนุฑุถ ุงูุฏููู ุงููุญุงุณุจู ุจูุฌุงุญ');
                
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุนุฑุถ ุงูุฏููู: ' + error.message);
            }
        }
        
        function fixLogin() {
            log('๐ง ุฅุตูุงุญ ุชุณุฌูู ุงูุฏุฎูู...');

            try {
                // ูุณุญ ุงููุณุชุฎุฏููู ุงูููุฌูุฏูู
                StorageManager.saveData(StorageManager.STORAGE_KEYS.USERS, []);
                log('๐๏ธ ุชู ูุณุญ ุงููุณุชุฎุฏููู ุงูููุฌูุฏูู');

                // ุฅูุดุงุก ุงููุณุชุฎุฏู ุงูุงูุชุฑุงุถู ุจูููุฉ ูุฑูุฑ ุบูุฑ ูุดูุฑุฉ (ููุงุฎุชุจุงุฑ)
                const defaultUsers = [
                    {
                        id: 'user_admin_' + Date.now(),
                        username: 'admin',
                        password: 'admin123', // ูููุฉ ูุฑูุฑ ุบูุฑ ูุดูุฑุฉ ููุงุฎุชุจุงุฑ
                        name: 'ุงููุฏูุฑ ุงูุนุงู',
                        role: 'admin',
                        permissions: ['all'],
                        isActive: true,
                        createdAt: new Date().toISOString()
                    }
                ];

                const usersSaved = StorageManager.saveData(StorageManager.STORAGE_KEYS.USERS, defaultUsers);
                if (usersSaved) {
                    log('โ ุชู ุฅูุดุงุก ุงููุณุชุฎุฏู ุงูุงูุชุฑุงุถู');
                    log('๐ค ุงุณู ุงููุณุชุฎุฏู: admin');
                    log('๐ ูููุฉ ุงููุฑูุฑ: admin123');

                    // ุงูุชุญูู ูู ุญูุธ ุงูุจูุงูุงุช
                    const savedUsers = StorageManager.getData(StorageManager.STORAGE_KEYS.USERS);
                    log(`๐ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุญููุธูู: ${savedUsers ? savedUsers.length : 0}`);
                    if (savedUsers && savedUsers.length > 0) {
                        log(`๐ค ุงููุณุชุฎุฏู ุงููุญููุธ: ${savedUsers[0].username}`);
                    }
                } else {
                    log('โ ูุดู ูู ุฅูุดุงุก ุงููุณุชุฎุฏู');
                }

                // ุฅูุดุงุก ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ
                const defaultSettings = {
                    exchangeRate: 1500,
                    currency: 'USD',
                    language: 'ar',
                    autoBackup: true,
                    backupInterval: 3600000
                };

                const settingsSaved = StorageManager.saveData(StorageManager.STORAGE_KEYS.SETTINGS, defaultSettings);
                if (settingsSaved) {
                    log('โ ุชู ุฅูุดุงุก ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ');
                } else {
                    log('โ ูุดู ูู ุฅูุดุงุก ุงูุฅุนุฏุงุฏุงุช');
                }

                // ุฅูุดุงุก ุจูุงูุงุช ูุงุฑุบุฉ ููุฃูุณุงู ุงูุฃุฎุฑู
                StorageManager.saveData(StorageManager.STORAGE_KEYS.SHAREHOLDERS, []);
                StorageManager.saveData(StorageManager.STORAGE_KEYS.CAPITAL, []);
                StorageManager.saveData(StorageManager.STORAGE_KEYS.EXPENSES, []);

                log('โ ุชู ุฅุตูุงุญ ุฌููุน ุงูุจูุงูุงุช');
                log('๐ ููููู ุงูุขู ุชุณุฌูู ุงูุฏุฎูู ุจู admin / admin123');

                // ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ
                setTimeout(() => {
                    testLoginDirectly();
                }, 1000);

            } catch (error) {
                log('โ ุฎุทุฃ ูู ุฅุตูุงุญ ุชุณุฌูู ุงูุฏุฎูู: ' + error.message);
            }
        }

        function testLoginDirectly() {
            log('๐งช ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ...');

            try {
                const users = StorageManager.getData(StorageManager.STORAGE_KEYS.USERS);
                if (!users || users.length === 0) {
                    log('โ ูุง ููุฌุฏ ูุณุชุฎุฏููู ูู ุงููุธุงู');
                    return;
                }

                const adminUser = users.find(u => u.username === 'admin');
                if (!adminUser) {
                    log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุณุชุฎุฏู admin');
                    return;
                }

                log('โ ุชู ุงูุนุซูุฑ ุนูู ุงููุณุชุฎุฏู admin');
                log(`๐ค ุงุณู ุงููุณุชุฎุฏู: ${adminUser.username}`);
                log(`๐ ูููุฉ ุงููุฑูุฑ ุงููุญููุธุฉ: ${adminUser.password}`);
                log(`โ ุญุงูุฉ ุงููุณุชุฎุฏู: ${adminUser.isActive ? 'ูุดุท' : 'ุบูุฑ ูุดุท'}`);

                // ูุญุงููุฉ ุชุณุฌูู ุฏุฎูู ุชุฌุฑูุจูุฉ
                if (adminUser.password === 'admin123') {
                    log('โ ูููุฉ ุงููุฑูุฑ ุตุญูุญุฉ - ูููู ุชุณุฌูู ุงูุฏุฎูู');
                } else {
                    log('โ๏ธ ูููุฉ ุงููุฑูุฑ ูุดูุฑุฉ - ูุฏ ุชุญุชุงุฌ ูุงุณุชุฎุฏุงู ุงููุธุงู ููุชุญูู');
                }

            } catch (error) {
                log('โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู: ' + error.message);
            }
        }

        function goToSystem() {
            log('๐ ุงูุงูุชูุงู ุฅูู ุงููุธุงู ุงูุฑุฆูุณู...');
            window.open('index.html', '_blank');
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('โ ุชู ุชุญููู ุงูุตูุญุฉ ุจูุฌุงุญ');
            log('๐ ุฌุงูุฒ ููุงุฎุชุจุงุฑ!');
            
            // Test storage
            if (typeof StorageManager !== 'undefined') {
                log('โ StorageManager ูุชููุฑ');
            } else {
                log('โ StorageManager ุบูุฑ ูุชููุฑ');
            }
        });
    </script>
</body>
</html>
